@model ClientHomeVM

@{
    ViewData["Title"] = "Home Page";
    var userName = User.Identity?.Name ?? "User";
    var now = DateTime.Now;
    var currentAppointments = Model.AppointmentList.Where(a => a.status == null || a.status.ToLower() != "canceled").ToList();
    var cancelledAppointments = Model.AppointmentList.Where(a => a.status != null && a.status.ToLower() == "canceled").ToList();
}

<style>
    .dashboard-card {
        min-height: 220px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .dashboard-card-cancelled {
        border: 2px solid #dc3545 !important;
        background-color: #f8d7da !important;
    }
</style>

<div class="container py-4">
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h2 class="mb-3">Welcome, @userName!</h2>
            <p class="lead text-secondary">
                Today is <strong>@now.ToString("dddd, MMMM d, yyyy")</strong><br />
                Current time: <strong>@now.ToString("hh:mm tt")</strong>
            </p>
        </div>
    </div>

    <h3 class="mb-4">Scheduled Appointments</h3>
    <div class="row g-4">
        @if (!currentAppointments.Any())
        {
            <div class="col-12 text-center text-muted">
                <em>No current appointments.</em>
            </div>
        }
        else
        {
            @foreach (var appointment in currentAppointments)
            {
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="card dashboard-card shadow rounded">
                        <div class="card-body d-flex flex-column justify-content-center align-items-center">
                            <p class="h5 text-dark text-uppercase text-center mb-2">@appointment.ApptDate.ToShortDateString()</p>
                            <p class="h5 text-dark text-uppercase text-center mb-2">@appointment.ApptTime.ToShortTimeString()</p>
                            @if(User.IsInRole(SD.Role_Staff))
                            {
                                <p class="text-warning text-center mb-2">with <b>@appointment.ClientName</b></p>
                            }
                            @if (User.IsInRole(SD.Role_Client))
                            {
                                <p class="text-warning text-center mb-2">with <b>@appointment.StaffName</b></p>
                            }
                            @if(User.IsInRole(SD.Role_Admin))
                            {
                                <p class="text-warning text-center mb-2"><b>@appointment.ClientName</b></p>
                                <p class="text-warning text-center mb-2">with <b>@appointment.StaffName</b></p>
                            }
                        </div>
                        <div class="card-footer bg-transparent border-0 pt-0">
                            @if (User.IsInRole(SD.Role_Staff))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Staff"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                            @if (User.IsInRole(SD.Role_Client))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Client"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                            @if (User.IsInRole(SD.Role_Admin))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Admin"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>

    <h3 class="mb-4 mt-5 text-danger">Cancelled Appointments</h3>
    <div class="row g-4">
        @if (!cancelledAppointments.Any())
        {
            <div class="col-12 text-center text-muted">
                <em>No cancelled appointments.</em>
            </div>
        }
        else
        {
            @foreach (var appointment in cancelledAppointments)
            {
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="card dashboard-card dashboard-card-cancelled shadow rounded">
                        <div class="card-body d-flex flex-column justify-content-center align-items-center">
                            <p class="h5 text-dark text-uppercase text-center mb-2">@appointment.ApptDate.ToShortDateString()</p>
                            <p class="h5 text-dark text-uppercase text-center mb-2">@appointment.ApptTime.ToShortTimeString()</p>
                            <span class="badge bg-danger mb-2">CANCELLED</span>
                            @if(User.IsInRole(SD.Role_Staff))
                            {
                                <p class="text-warning text-center mb-2">with <b>@appointment.ClientName</b></p>
                            }
                            @if (User.IsInRole(SD.Role_Client))
                            {
                                <p class="text-warning text-center mb-2">with <b>@appointment.StaffName</b></p>
                            }
                            @if(User.IsInRole(SD.Role_Admin))
                            {
                                <p class="text-warning text-center mb-2"><b>@appointment.ClientName</b></p>
                                <p class="text-warning text-center mb-2">with <b>@appointment.StaffName</b></p>
                            }
                        </div>
                        <div class="card-footer bg-transparent border-0 pt-0">
                            @if (User.IsInRole(SD.Role_Staff))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Staff"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                            @if (User.IsInRole(SD.Role_Client))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Client"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                            @if (User.IsInRole(SD.Role_Admin))
                            {
                                <a asp-action="Details" asp-controller="Appointment" asp-area="Admin"
                                   asp-route-appointmentId="@appointment.Id"
                                   class="btn btn-primary w-100">
                                    Details
                                </a>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

